# Makefile for the AW_Config
#
# @author Marcelo Cora√ßa de Freitas <marcelo.batera@gmail.com> 


APP=.:../awlib

################
# Main targets #
################
all: tests

base:
	ADA_PROJECT_PATH=${APP} gnatmake -P awconfig.gpr

clean: 
	@-rm bin/* lib/* obj/*
	@echo "All clean"

docs:
	@-./gendoc.sh
	@echo "The documentation is generated by a bash script. Then it might fail in other platforms than Linux"

install:
	@cat INSTALL
# TODO: implement the install target	
# FIXME: I should create gpr files to be included by other projects.


##################
# Parser Targets #
##################

text-parser: base
	ADA_PROJECT_PATH=.:../awlib gnatmake -P awconfig-text_parser.gpr
	
xml-parser: base
	ADA_PROJECT_PATH=.:../awlib gnatmake -P awconfig-xml_parser.gpr `xmlada-config`

parsers: text-parser xml-parser



#################
# Tests Targets #
#################

text-test: text-parser
	ADA_PROJECT_PATH=.:../awlib gnatmake -P awconfig-text_test.gpr

xml-test: xml-parser
	ADA_PROJECT_PATH=.:../awlib gnatmake -P awconfig-xml_test.gpr

tests: text-test xml-test

#####################
# Run-Tests Targets #
#####################

run-xml: tests
	TEST_CONFIG_PATH=$(PWD)/data ./bin/xml-test


run-plain: tests
	TEST_CONFIG_PATH=$(PWD)/data ./bin/plain-test

run: run-xml run-plain


